<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GRUPO HENRI SISTEMAS - Sistema de Orçamentos</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f0017">
    <link rel="apple-touch-icon" href="assets/icone.png"> <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="assets/icone.png" type="image/png"> 
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Estilo para o status do Firebase no cabeçalho */
        #cloud-status-container {
            text-align: right;
            padding: 10px 20px;
            background-color: transparent; 
            color: white; 
            font-weight: bold; 
        }
        #firebase-cloud-status {
            font-weight: bold;
            font-size: 0.9em;
        }
        /* Classe para agrupar botões de ação do formulário */
        .form-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap; 
        }

        /* Estilos para o Modal de Confirmação de Exclusão (Swipe-to-delete) */
        #swipe-confirm-modal .modal-content {
            text-align: center;
        }
        #swipe-container {
            position: relative;
            width: 90%;
            height: 50px;
            background-color: #e0e0e0;
            border-radius: 25px;
            margin: 20px auto;
            overflow: hidden;
            border: 1px solid #ccc;
            cursor: pointer;
        }
        #swipe-handle {
            position: absolute;
            left: 0;
            top: 0;
            width: 60px;
            height: 100%;
            background-color: #ff4d4d;
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            z-index: 2;
            transition: left 0.3s ease, background-color 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #swipe-text {
            position: absolute;
            left: 0;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1;
            color: #333;
            font-weight: bold;
        }
        #swipe-container.confirmed #swipe-handle {
            background-color: #4caf50;
        }
        #swipe-cancel-btn {
            background-color: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Estilos para Modais Responsivos */
        #editOrcamentoModal .modal-content, 
        #novoContratoModal .modal-content,
        #novaTransacaoModal .modal-content,
        #novaTransferenciaModal .modal-content {
            display: flex;
            flex-direction: column;
            width: 80%;
            max-width: 900px;
            height: auto; 
            max-height: 90vh; 
            padding: 0; 
            overflow: hidden; 
        }
        #editOrcamentoModal .modal-header,
        #novoContratoModal .modal-header,
        #novaTransacaoModal .modal-header,
        #novaTransferenciaModal .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0; 
            background-color: var(--cor-fundo-secundario); 
        }
        .modal-header h3 {
            margin-bottom: 0 !important; 
        }
        .modal-header .close-modal {
             font-size: 1.8rem;
             position: static; 
        }
        #editOrcamentoModal .modal-body-scrollable,
        #novoContratoModal .modal-body-scrollable,
        #novaTransacaoModal .modal-body-scrollable,
        #novaTransferenciaModal .modal-body-scrollable {
            overflow-y: auto; 
            padding: 15px 20px;
        }
        #editOrcamentoModal .modal-footer,
        #novoContratoModal .modal-footer,
        #novaTransacaoModal .modal-footer,
        #novaTransferenciaModal .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #e0e0e0;
            flex-shrink: 0; 
        }
        
        @media (max-width: 768px) {
            #editOrcamentoModal .modal-content,
            #novoContratoModal .modal-content,
            #novaTransacaoModal .modal-content,
            #novaTransferenciaModal .modal-content {
                width: 95%; 
                max-height: 95vh;
            }
            .modal-header,
            .modal-body-scrollable,
            .modal-footer {
                padding: 12px; 
            }
        }
    </style>
    
    <style>
        @media (max-width: 1400px) {
            html {
                font-size: 92%;
            }
            h2 {
                font-size: 1.6rem;
            }
            .form-group input,
            .form-group select,
            .form-group textarea {
                padding: 8px;
            }
            .btn-primary, .btn-secondary, .btn-google, .btn-danger, .btn-editar, .btn-excluir, .btn-preview,
            #adicionar-item-btn, #gerar-pdf-btn, #salvar-orcamento-btn, #novo-orcamento-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            main > section {
                padding: 18px;
            }
            nav a {
                padding: 12px 10px;
                font-size: 0.9rem;
            }
            #clientes-tabela th, #clientes-tabela td,
            #orcamento-itens-tabela th, #orcamento-itens-tabela td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div id="splash-screen">
        <div class="loader">
            <div class="outer"></div>
            <div class="middle"></div>
            <div class="inner"></div>
            <div class="icon"><i class="fas fa-lock"></i></div>
            <div class="text" data-text="LOADING"></div>
            <div class="company-name">GRUPO HENRI SISTEMAS</div>
            <div class="tagline">Protegendo o que é seu</div>
            <div class="loading-bar-container">
                <div class="loading-bar"></div>
            </div>
        </div>
    </div>
    <div class="app-wrapper">
        <header>
            <div class="logo-container">
                <img src="assets/logo.png" alt="GRUPO HENRI SISTEMAS Logo" id="company-logo">
                <div class="company-info">
                    <h1>GRUPO HENRI SISTEMAS</h1>
                    <p>SEGURANÇA ELETRÔNICA</p>
                    <p>Contato: 24 99223-2018 / 24 99296-9844</p>
                    <p>CNPJ: 22.827.727/0001-80</p>
                </div>
            </div>
             <div id="header-status-area">
                <div id="cloud-status-container">
                    Firebase Cloud: <span id="firebase-cloud-status">Desconectado</span>
                </div>
            </div>
        </header>

        <div class="container">
            <nav>
                <ul>
                    <li><a href="#" id="nav-clientes"><i class="fas fa-users"></i> Clientes</a></li>
                    <li><a href="#" id="nav-produtos"><i class="fas fa-box-open"></i> Produtos</a></li>
                    <li><a href="#" id="nav-orcamentos"><i class="fas fa-file-invoice-dollar"></i> Orçamentos</a></li>
                    <li><a href="#" id="nav-contratos"><i class="fas fa-file-contract"></i> Contratos</a></li>
                    <li><a href="#" id="nav-financeiro"><i class="fas fa-chart-line"></i> Financeiro</a></li>
                    <li><a href="#" id="nav-backup"><i class="fas fa-cloud-upload-alt"></i> Backup & Restore</a></li>
                </ul>
            </nav>

            <main>
                <section id="clientes-section" class="active">
                    <h2><i class="fas fa-users"></i> Gerenciar Clientes</h2>
                    <form id="cliente-form">
                        <input type="hidden" id="cliente-id">
                        <div class="form-group">
                            <label for="cliente-nome">Nome ou Empresa:</label>
                            <input type="text" id="cliente-nome" required>
                        </div>
                        <div class="form-group">
                            <label for="cliente-cpf-cnpj">CPF ou CNPJ:</label>
                            <input type="text" id="cliente-cpf-cnpj">
                        </div>
                        <div class="form-group">
                            <label for="cliente-telefone">Telefone:</label>
                            <input type="tel" id="cliente-telefone" placeholder="(XX) XXXXX-XXXX ou (XX) XXXX-XXXX">
                        </div>
                        <div class="form-group">
                            <label for="cliente-endereco">Endereço:</label>
                            <input type="text" id="cliente-endereco">
                        </div>
                        <div class="form-actions">
                            <button type="submit" id="salvar-novo-cliente-btn" class="btn-primary"><i class="fas fa-save"></i> Salvar & Novo</button>
                        </div>
                    </form>
                    
                    <h3 class="mt-20">Clientes Salvos</h3>
                    <div id="clientes-cards-container">
                        </div>
                </section>

                <section id="produtos-section">
                    <h2><i class="fas fa-box-open"></i> Gerenciar Produtos</h2>
                    <form id="produto-form">
                        <input type="hidden" id="produto-id">
                        <div class="form-group">
                            <label for="produto-nome-proposta">Nome para Proposta:</label>
                            <input type="text" id="produto-nome-proposta" required>
                        </div>
                        <div class="form-group">
                            <label for="produto-nome-real">Nome Real (Interno):</label>
                            <input type="text" id="produto-nome-real">
                        </div>
                        <div class="form-group">
                            <label for="produto-categoria">Categoria:</label>
                            <input type="text" id="produto-categoria" placeholder="Ex: CFTV, Alarmes, Cabos">
                        </div>
                        <div class="form-group">
                            <label for="produto-valor">Valor (R$):</label>
                            <input type="number" id="produto-valor" step="0.01" min="0" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" id="salvar-novo-produto-btn" class="btn-primary"><i class="fas fa-save"></i> Salvar & Novo</button>
                        </div>
                    </form>
                    
                    <h3 class="mt-20">Categorias de Produtos</h3>
                    <div id="categorias-container">
                        </div>
                </section>

                <section id="orcamentos-section">
                    <h2><i class="fas fa-file-invoice-dollar"></i> Gerenciar Orçamentos</h2>
                    <form id="orcamento-form">
                        <div class="form-group">
                            <label for="orcamento-cliente">Cliente:</label>
                            <select id="orcamento-cliente" required>
                                <option value="">Selecione um cliente...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="orcamento-servicos">Descrição dos Serviços (para o PDF):</label>
                            <input type="text" id="orcamento-servicos" placeholder="Ex: Instalação de sistema de CFTV completo">
                        </div>

                        <div class="form-group">
                            <label for="orcamento-mao-de-obra">Valor Mão de Obra (R$):</label>
                            <input type="number" id="orcamento-mao-de-obra" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label for="orcamento-relatorio">Relatório/Observações:</label>
                            <textarea id="orcamento-relatorio" rows="4"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="orcamento-formas-pagamento">Formas de Pagamento:</label>
                            <textarea id="orcamento-formas-pagamento" rows="2"></textarea>
                        </div>
                        <button type="button" id="adicionar-item-btn" class="btn-secondary"><i class="fas fa-plus-circle"></i> Adicionar Item</button>
                        <button type="button" id="gerar-pdf-btn" class="btn-primary"><i class="fas fa-file-pdf"></i> Gerar PDF</button>
                        <button type="button" id="salvar-novo-orcamento-btn" class="btn-primary"><i class="fas fa-save"></i> Salvar & Novo Orçamento</button>
                    </form>

                    <h3>Itens do Orçamento</h3>
                    <div class="table-container">
                        <table id="orcamento-itens-tabela">
                            <thead>
                                <tr>
                                    <th>Produto/Serviço</th>
                                    <th>Quantidade</th>
                                    <th>Valor UND</th>
                                    <th>Total Item</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <div class="orcamento-details mt-20">
                        <p><strong>Total de Produtos:</strong> <span id="total-produtos">R$ 0,00</span></p>
                        <p><strong>Total Geral (com Mão de Obra):</strong> <span id="total-geral">R$ 0,00</span></p>
                    </div>

                    <h3 class="mt-20">Orçamentos Salvos</h3>
                    <ul id="lista-orcamentos">
                    </ul>
                </section>
                
                <section id="contratos-section">
                    <h2><i class="fas fa-file-contract"></i> Gestão de Contratos</h2>
                    <div class="form-actions mb-20">
                        <button id="novo-contrato-btn" class="btn-primary"><i class="fas fa-plus"></i> Novo Contrato</button>
                        <button id="exportar-contratos-pdf-btn" class="btn-secondary"><i class="fas fa-file-pdf"></i> Exportar Lista</button>
                    </div>

                    <div id="alertas-reajuste-container" style="display:none;" class="mb-20">
                        </div>

                    <div class="table-container">
                        <table id="contratos-tabela">
                            <thead>
                                <tr>
                                    <th>Cliente</th>
                                    <th>Descrição / Locação</th>
                                    <th>Valor (R$)</th>
                                    <th>Dia Venc.</th>
                                    <th>Reajuste (Mês)</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </section>

                <section id="financeiro-section">
                    <h2><i class="fas fa-chart-line"></i> Controle Financeiro</h2>
                    
                    <div class="financeiro-dashboard">
                        <div class="fin-card pj">
                            <h4><i class="fas fa-building"></i> Total PJ (Mês)</h4>
                            <p id="dashboard-total-pj">R$ 0,00</p>
                        </div>
                        <div class="fin-card pf">
                            <h4><i class="fas fa-user"></i> Total PF (Mês)</h4>
                            <p id="dashboard-total-pf">R$ 0,00</p>
                        </div>
                        <div class="fin-card caixa">
                            <h4><i class="fas fa-wallet"></i> Caixa Empresa</h4>
                            <p id="dashboard-caixa-empresa">R$ 0,00</p>
                        </div>
                        <div class="fin-card saldo">
                             <h4><i class="fas fa-balance-scale"></i> Saldo Geral</h4>
                             <p id="dashboard-saldo-geral">R$ 0,00</p>
                        </div>
                    </div>

                    <div class="financeiro-controls mt-20">
                        <div class="date-filter">
                            <select id="financeiro-mes"></select>
                            <select id="financeiro-ano"></select>
                            <button id="filtrar-financeiro-btn" class="btn-secondary"><i class="fas fa-filter"></i> Filtrar</button>
                        </div>
                        <div class="action-buttons">
                            <button id="nova-receita-btn" class="btn-faturamento"><i class="fas fa-arrow-up"></i> Receita</button>
                            <button id="nova-despesa-btn" class="btn-danger"><i class="fas fa-arrow-down"></i> Despesa</button>
                            <button id="nova-transferencia-btn" class="btn-transferencia"><i class="fas fa-exchange-alt"></i> Transferir</button>
                            <button id="exportar-financeiro-btn" class="btn-primary"><i class="fas fa-file-invoice-dollar"></i> PDF Analítico</button>
                        </div>
                    </div>

                    <div class="chart-container mt-20">
                        <canvas id="financeiroChart"></canvas>
                    </div>

                    <h3 class="mt-20"><i class="fas fa-calendar-check"></i> Calendário de Despesas</h3>
                    <div id="financeiro-calendar-container" class="mb-20">
                        <div id="fin-calendar-days" class="calendar-grid"></div>
                        <div class="calendar-legend">
                            <span><span class="dot red"></span> Despesas Empresa</span>
                            <span><span class="dot yellow"></span> Despesas Pessoais (PF)</span>
                        </div>
                    </div>

                    <h3>Movimentações do Mês</h3>
                    <div class="table-container">
                        <table id="transacoes-tabela">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Tipo</th>
                                    <th>Categoria</th>
                                    <th>Descrição</th>
                                    <th>Valor</th>
                                    <th>Conta</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>

                <section id="backup-section">
                    <h2><i class="fas fa-cloud-upload-alt"></i> Backup & Restore</h2>
                    <p class="mb-20" style="color: var(--cor-destaque-primaria); text-align: center; border: 1px solid var(--cor-destaque-secundaria); padding: 10px; border-radius: 5px;">
                        <strong>IMPORTANTE:</strong> Seus dados podem ser salvos localmente no navegador ou na nuvem com o login do Google. Faça backups regularmente.
                    </p>
                    <div class="backup-actions">
                        <button id="exportar-backup-btn" class="btn-primary"><i class="fas fa-download"></i> Exportar Backup</button>
                        <label for="importar-backup-file" class="btn btn-secondary">
                            <i class="fas fa-upload"></i> Importar Backup
                            <input type="file" id="importar-backup-file" accept=".json" style="display: none;">
                        </label>
                        <button id="google-login-btn" class="btn-google"><i class="fab fa-google"></i> LOGIN GOOGLE NECESSARIO</button>
                        <button id="google-logout-btn" class="btn-google" style="display:none;"><i class="fas fa-sign-out-alt"></i> LOGADO COM FIREBASE CLOUD</button>
                    </div>

                    <div class="backup-status-info mt-20">
                        <p>Status: <span id="backup-status">Pronto</span></p>
                        <p>Último Backup: <span id="ultimo-backup">Nenhum</span></p>
                        <p>Status Firebase (Detalhado): <span id="firebase-status" style="font-weight: bold;">Desconectado</span></p>
                    </div>
                </section>
            </main>
        </div>

        <footer>
            <p>&copy; <span id="current-year">2024</span> GRUPO HENRI SISTEMAS - Segurança Eletrônica. Todos os direitos reservados.</p>
        </footer>
    </div>
    
    <div id="cliente-details-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3 id="cliente-modal-title">Detalhes do Cliente</h3>
            <div id="cliente-modal-body">
                <p><strong>Nome/Empresa:</strong> <span id="cliente-detalhe-nome"></span></p>
                <p><strong>CPF/CNPJ:</strong> <span id="cliente-detalhe-cpf-cnpj"></span></p>
                <p><strong>Telefone:</strong> <span id="cliente-detalhe-telefone"></span></p>
                <p><strong>Endereço:</strong> <span id="cliente-detalhe-endereco"></span></p>
            </div>
            <div class="modal-footer">
                <div class="form-actions">
                    <button type="button" id="cliente-modal-edit-btn" class="btn-editar"><i class="fas fa-edit"></i> Editar</button>
                    <button type="button" id="cliente-modal-delete-btn" class="btn-danger"><i class="fas fa-trash-alt"></i> Excluir</button>
                </div>
            </div>
        </div>
    </div>

    <div id="itemModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3>Adicionar Item ao Orçamento</h3>
            <form id="item-form">
                <input type="hidden" id="modal-item-index">
                <div class="form-group">
                    <label for="modal-item-categoria">Categoria:</label>
                    <select id="modal-item-categoria">
                        <option value="">Selecione uma categoria...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-produto">Produto/Serviço:</label>
                    <select id="modal-produto" required>
                        <option value="">Selecione um produto...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-quantidade">Quantidade:</label>
                    <input type="number" id="modal-quantidade" min="1" value="1" required>
                </div>
                <div class="form-group">
                    <label for="modal-valor">Valor UND (R$):</label>
                    <input type="number" id="modal-valor" step="0.01" min="0" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary"><i class="fas fa-plus-circle"></i> Adicionar Item</button>
                    <button type="button" id="delete-item-btn" class="btn-danger" style="display: none;"><i class="fas fa-trash-alt"></i> Excluir Item</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="produtosCategoriaModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="close-produtos-categoria-modal">&times;</span>
            <h3 id="produtos-categoria-modal-title">Produtos da Categoria</h3>
            <div id="produtos-categoria-modal-body">
                </div>
        </div>
    </div>
    
    <div id="editOrcamentoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="edit-orcamento-modal-title">Editar Orçamento</h3>
                <span class="close-modal" id="close-edit-orcamento-modal">&times;</span>
            </div>
            <div class="modal-body-scrollable">
                <form id="edit-orcamento-form">
                    <input type="hidden" id="edit-orcamento-id">
                    <div class="form-group">
                        <label for="edit-orcamento-cliente">Cliente:</label>
                        <select id="edit-orcamento-cliente" required></select>
                    </div>
                    <div class="form-group">
                        <label for="edit-orcamento-servicos">Descrição dos Serviços:</label>
                        <input type="text" id="edit-orcamento-servicos">
                    </div>
                    <div class="form-group">
                        <label for="edit-orcamento-mao-de-obra">Valor Mão de Obra (R$):</label>
                        <input type="number" id="edit-orcamento-mao-de-obra" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="edit-orcamento-relatorio">Relatório/Observações:</label>
                        <textarea id="edit-orcamento-relatorio" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-orcamento-formas-pagamento">Formas de Pagamento:</label>
                        <textarea id="edit-orcamento-formas-pagamento" rows="2"></textarea>
                    </div>
                </form>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                    <h4>Itens do Orçamento</h4>
                    <button type="button" id="add-item-to-edited-orcamento-btn" class="btn-secondary btn-sm"><i class="fas fa-plus-circle"></i> Adicionar Item</button>
                </div>
                <div class="table-container">
                    <table id="edit-orcamento-itens-tabela">
                        <thead>
                            <tr>
                                <th>Produto</th>
                                <th>Qtd</th>
                                <th>Valor UND</th>
                                <th>Total</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <div class="orcamento-details mt-20">
                    <p><strong>Total de Produtos:</strong> <span id="edit-total-produtos">R$ 0,00</span></p>
                    <p><strong>Total Geral:</strong> <span id="edit-total-geral">R$ 0,00</span></p>
                </div>
            </div>
            <div class="modal-footer">
                <div class="form-actions">
                    <button type="button" id="save-orcamento-changes-btn" class="btn-primary"><i class="fas fa-save"></i> Salvar Alterações</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="swipe-confirm-modal" class="modal">
        <div class="modal-content">
            <h3>Confirmar Exclusão</h3>
            <p>Esta ação não pode ser desfeita. Para confirmar, arraste o controle para a direita.</p>
            <div id="swipe-container">
                <div id="swipe-handle"><i class="fas fa-chevron-right"></i><i class="fas fa-chevron-right"></i></div>
                <div id="swipe-text">Arraste para Excluir</div>
            </div>
            <button type="button" id="swipe-cancel-btn" class="btn-secondary mt-20">Cancelar</button>
        </div>
    </div>

    <div id="novoContratoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Novo Contrato</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body-scrollable">
                <form id="novo-contrato-form">
                    <input type="hidden" id="contrato-id">
                    <div class="form-group">
                        <label for="contrato-cliente">Cliente:</label>
                        <select id="contrato-cliente" required></select>
                    </div>
                    <div class="form-group">
                        <label for="contrato-descricao">Descrição (Serviços/Locação):</label>
                        <textarea id="contrato-descricao" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="contrato-valor">Valor Mensal (R$):</label>
                        <input type="number" id="contrato-valor" step="0.01" min="0" required>
                    </div>
                    <div class="form-row" style="display: flex; gap: 15px;">
                        <div class="form-group" style="flex: 1;">
                            <label for="contrato-dia-vencimento">Dia de Vencimento:</label>
                            <input type="number" id="contrato-dia-vencimento" min="1" max="31" required>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="contrato-mes-reajuste">Mês de Reajuste:</label>
                            <select id="contrato-mes-reajuste">
                                <option value="1">Janeiro</option>
                                <option value="2">Fevereiro</option>
                                <option value="3">Março</option>
                                <option value="4">Abril</option>
                                <option value="5">Maio</option>
                                <option value="6">Junho</option>
                                <option value="7">Julho</option>
                                <option value="8">Agosto</option>
                                <option value="9">Setembro</option>
                                <option value="10">Outubro</option>
                                <option value="11">Novembro</option>
                                <option value="12">Dezembro</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                         <label><input type="checkbox" id="contrato-ativo" checked> Contrato Ativo</label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="salvar-contrato-btn" class="btn-primary"><i class="fas fa-save"></i> Salvar Contrato</button>
            </div>
        </div>
    </div>

    <div id="novaTransacaoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-transacao-titulo">Nova Transação</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body-scrollable">
                <form id="nova-transacao-form">
                    <input type="hidden" id="transacao-id">
                    <input type="hidden" id="transacao-tipo"> <div class="form-group">
                        <label for="transacao-categoria">Categoria:</label>
                        <select id="transacao-categoria" required>
                            </select>
                    </div>

                    <div class="form-group" id="group-contrato-select" style="display:none;">
                        <label for="transacao-contrato-id">Contrato Vinculado:</label>
                        <select id="transacao-contrato-id"></select>
                    </div>

                    <div class="form-group">
                        <label for="transacao-descricao">Descrição / Detalhes:</label>
                        <input type="text" id="transacao-descricao" required>
                    </div>

                    <div class="form-row" style="display: flex; gap: 15px;">
                        <div class="form-group" style="flex: 1;">
                            <label for="transacao-valor">Valor (R$):</label>
                            <input type="number" id="transacao-valor" step="0.01" min="0" required>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="transacao-data">Data:</label>
                            <input type="date" id="transacao-data" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="transacao-conta">Conta/Destino:</label>
                        <select id="transacao-conta" required>
                            <option value="pj">Pessoa Jurídica (PJ)</option>
                            <option value="pf">Pessoa Física (PF)</option>
                            <option value="caixa">Caixa Empresa</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="transacao-status">Status:</label>
                        <select id="transacao-status" required>
                            <option value="pendente">Pendente / A Receber</option>
                            <option value="pago">Pago / Recebido</option>
                        </select>
                    </div>

                    <div class="form-group" id="group-recorrente" style="border-top: 1px solid #444; padding-top: 10px; margin-top: 10px;">
                        <label><input type="checkbox" id="transacao-recorrente"> Salvar como Recorrente (Despesa Fixa)</label>
                        <p style="font-size: 0.8em; color: #aaa;">Se marcado, esta despesa será gerada automaticamente todo mês.</p>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="salvar-transacao-btn" class="btn-primary"><i class="fas fa-save"></i> Salvar</button>
            </div>
        </div>
    </div>

    <div id="novaTransferenciaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nova Transferência</h3>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body-scrollable">
                <form id="nova-transferencia-form">
                    <p style="margin-bottom: 15px; color: #aaa; font-size: 0.9em;">
                        Transferências criam uma <strong>SAÍDA</strong> na conta de origem e uma <strong>ENTRADA</strong> na conta de destino.
                    </p>
                    
                    <div class="form-row" style="display: flex; gap: 15px;">
                        <div class="form-group" style="flex: 1;">
                            <label for="transf-origem">De (Origem):</label>
                            <select id="transf-origem" required>
                                <option value="pj">Pessoa Jurídica (PJ)</option>
                                <option value="pf">Pessoa Física (PF)</option>
                                <option value="caixa">Caixa Empresa</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label for="transf-destino">Para (Destino):</label>
                            <select id="transf-destino" required>
                                <option value="caixa">Caixa Empresa</option>
                                <option value="pj">Pessoa Jurídica (PJ)</option>
                                <option value="pf">Pessoa Física (PF)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="transf-valor">Valor (R$):</label>
                        <input type="number" id="transf-valor" step="0.01" min="0" required>
                    </div>

                    <div class="form-group">
                        <label for="transf-data">Data:</label>
                        <input type="date" id="transf-data" required>
                    </div>

                    <div class="form-group">
                        <label for="transf-obs">Observação (Opcional):</label>
                        <input type="text" id="transf-obs" placeholder="Motivo da transferência">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" id="salvar-transferencia-btn" class="btn-primary"><i class="fas fa-exchange-alt"></i> Confirmar Transferência</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, collection } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAYFweRxESPvNEuPESJ6Zfuka0VrgS6Cuk",
            authDomain: "appweb-grupohenriques.firebaseapp.com",
            projectId: "appweb-grupohenriques",
            storageBucket: "appweb-grupohenriques.firebasestorage.app",
            messagingSenderId: "135980745273",
            appId: "1:135980745273:web:de51c3604c8617a75743e8",
            measurementId: "G-SF2BKEB0MX"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.jsPDF = window.jspdf.jsPDF;
        document.getElementById('current-year').textContent = new Date().getFullYear();

        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.GoogleAuthProvider = GoogleAuthProvider;
        window.signInWithPopup = signInWithPopup;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
        window.firebaseDoc = doc;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;
        window.firebaseCollection = collection;

    </script>
    <script src="script.js"></script>
    <script src="pdf-generator.js"></script>
    <script src="backup.js"></script>
    
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('ServiceWorker: Registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker: Registration failed: ', err);
                    });
            });
        }
    </script>

    <script>
        window.addEventListener('load', () => {
            const splash = document.getElementById('splash-screen');
            const appWrapper = document.querySelector('.app-wrapper');

            setTimeout(() => {
                splash.classList.add('hidden');
                appWrapper.classList.add('visible');
                setTimeout(() => {
                    splash.remove();
                }, 500);
            }, 4000); 
        });
    </script>
    </body>
</html>